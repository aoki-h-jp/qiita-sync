<!--
title:   非同期処理で立ち上げたlambdaのDLQはFIFOキューに入れられない
tags:    AWS,FIFO,SNS,lambda,sqs
id:      294b9d44a938ed76b690
private: false
-->
当たり前といえば当たり前かもしれないですが、設計時点で気が付かなかったのでメモ。

非同期実行の例としてS3, API Gatewayを想定しています。青い矢印は正常に疎通が取れます。

![名称未設定ファイル.drawio (6).png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2882979/1db77976-0ba3-d5dd-fd2d-12ffa2bb4715.png)

# なぜこうなるのか
非同期実行でLambdaへ処理が流れてきたときに、Lambda内で並列的に同時実行されるためだと思います。

要するに、流れてきたときには処理A, 処理B, 処理C, ...という順序で流れてきたものが、再試行後の失敗時にはその順序が(例えば) 処理C, 処理A, 処理B, ...と変わってしまっている可能性が高いためです。

そのためFIFOキューの特徴である順序を保つということが保証できなくなり、仕様上送信できないのではないかと思われます。

**※ですが、console上ではFIFOキューをDLQとして設定できてしまうので要注意**